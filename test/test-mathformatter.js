/**
 * test-mathformatter - unit tests for MathFormatter.js
 *
 * ATTENTION: expected values must be enclosed in single quotes.
 * dataurl values should NOT be enclosed in any quotes.
 */
"use strict";
var MathFormatter = require('../lib/MathFormatter.js');

var figures;
var mf;

exports['setUp'] = function(callback) {
    figures = new Map();
    figures.set("figure-01", "<div><img src=data:image/png;base64,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></div>");
    figures.set("figure-10", "<div><img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABJAQMAAABLvZmfAAAABlBMVEX///8jHyCZ/QWRAAAALUlEQVQoz2P4DwMNDA0MCgwcDEwMDEOPieYLBpDo0GP+//8AyGQe8r4YXikKAHXFeVRwVlYzAAAAAElFTkSuQmCC></div>");
    figures.set("figure-14", "<div><img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABTCAMAAABXqPIJAAACMVBMVEX///+oqa0jHyAsKStramzPzs7//vrfmlU/PT6b3vokJlbz8/OhoaXb2tuKio5RT1JQTU4wLS6SkpZeXF1JR0gjHzu++v//+eO1tLWZmp2DgoXy///+++uop6ibmpp7en0nNnV0c3NjYWRRTk82MzXn/v/H7vz//fbn5+f9+Nz+9MPCwcIkTZf7049+fH18enqyhW5aWVvPiEgwHytxRikiHyhpKCH4///b/v/R/P/j+f7Z+f688v7P7Pv//O+21u93ve9or+RYod1Smtj+99dLlNW+vb0wb7f/77L84KWZl5f91pTEoo6Ni4z3w31ncnjyuHJubG06VWjgnl1kVU8kIUprV0A2NDYrJyg3HyiSRSdeNCdFICU+JyNLICDT+P7//vzU7/u46Pui4vrE5fmV2fjP5fay3vWt6PR+w+9xuOp4t+D+99X+79L53s7+9s1YjsVeg8X+7sN4msLPvr5BdbxSg7rv2LnvxLhrmrSElLPv2LE0arD+6KxJXadUl6WEkKRegqOMd6JSdaEkVqGEoZ/lw5qKcpk0V5lkiJheapjvzZdEaY4sT4x+h4gkQIjvwoGtmoCbV340T30kOHgwN3YkOHVCW2+ERGtQVWrorGjDkGSEcGOQfF0lKl1QT1y9iFndmlczOFfIiVO+dVJLTE3UjkybcEszPkvDfUZQTURQP0G+dT2+dTg7IDcsIDZsODUzITWiVjAkHzCETy8jHyybUCqQSSmENSJ3JyBYISDtRhi9AAACwklEQVRYw+3Z1VfbYBjH8d/elCwjSb1UqEApMtwZPoaMwbAxhjN3d3d3d3d331+3HjboaTu6juY5Z5zD9yIXuXg+Sd67Jxjvv6lxfREUaHL2bK1W07JjPgKyv4orgxIl50ZP4nd+urIA/u0u/DwNSsRPjJ4ENHdXB9xu39uTPkU5oDUv4HFTry27b1quDGDaXne+93QS/GrdHFtfOD1WGeC483b/xaX+Z//hmfZF/52Fin2ijAH/D56xJ9F76asFIEdFkDwEpH6Pi4Ev+6MVAGq+XCoDulgEdf0G+HN9uxIxnPnmm/2LwB/JLzhVCU41YdSpOJhn5hfMip/z/mA5RihCwNeYBNzUgJGNdYCjBhgxoKcGbNSAykAMGDOJAc5CC+iZTAvE60ALaNqIAWahBWwshRbISQApIHEOWsDFRFrA2AZSwMrSaIEcAaSAxBy0gEonkgIS1wBSwPsCpICVOUEKaASQAmqWRgpIHgNIAbcuhRRQMwcoAanTAFJAoxNJARWLAiVgYw2gBPRcFigBK5cgUgKSoBVBCEiCTgQh4J0vgxDQewQZhIDed74kgIt55xMCbpYJ0AFWgVlACNg4QQYdIGlYpgg6IJ4T0gAyQC2wJhFkgNrIDDJCxUJszO+27KsMAILHRwF/B1Znv3x8/fDRYr+NecdifuvTt+tiRwIkl+AbHxqY8W5LCewPL8cEbWvtz01Vfwb0ORzLigLCAdZ+TS8FUHMhCPDaPw4lBgM2dycTHCIQHtDcXQtv87YlBQOp3+Ji/AG1SsOYtklGmDEkPzFNhS9/YFXPMGBVu1QagTEhy5KC8GOoeB0CqC88WwzO42GDcRz798C3f6waCeBv5FUDFqdzcI0+2hoHfv2GWFMeCPAne4/NRcRV5HasLAI2HCjFUEMb8wcbS6BA5nt5V8/cOpEEusyb6pZgvPEU7Cd8L3ETnnys2wAAAABJRU5ErkJggg==></div>");
    mf = new MathFormatter(figures);
    return callback();
};

exports['tearDown'] = function(callback) {
    return callback();
};

exports['no backticks'] = function (test) {
  var question = "How much is 1 + 1?";
  var promise = mf.format(question);
  promise.then( (formattedQuestion) => {
      test.expect(1);
      test.equal(formattedQuestion, question, "question should be unchanged");
      test.done();
  }, (failMsg) => {
      test.expect(1);
      test.ok(false, "Should not fail!");
      test.done();
  });
};

exports['formula at front of question'] = function (test) {
    var question = "`((2^4)^9)/((4^8)^2)` Has what value?";
    var expect = '<span class="mjx-chtml"><span class="mjx-math" aria-label="((2^4)^9)/((4^8)^2)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.394em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.394em; top: -2.044em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.907em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">9</span></span></span></span></span></span><span class="mjx-denominator" style="width: 2.394em; bottom: -1.547em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.607em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">8</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.912em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 2.394em;" class="mjx-line"></span></span><span style="height: 3.592em; vertical-align: -1.547em;" class="mjx-vsize"></span></span></span></span></span></span></span> Has what value?';
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.equal(formattedQuestion, expect);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(false, failMsg);
        test.done();
    });
};

exports['formula at end of question'] = function (test) {
    var question = "What is the value? `((2^4)^9)/((4^8)^2)`";
    var expect = 'What is the value? <span class="mjx-chtml"><span class="mjx-math" aria-label="((2^4)^9)/((4^8)^2)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.394em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.394em; top: -2.044em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.907em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">9</span></span></span></span></span></span><span class="mjx-denominator" style="width: 2.394em; bottom: -1.547em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.607em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">8</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.912em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 2.394em;" class="mjx-line"></span></span><span style="height: 3.592em; vertical-align: -1.547em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.equal(formattedQuestion, expect);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(false, failMsg);
        test.done();
    });
};

exports['two forumulas within question'] = function (test) {
    var question = "First formula: `sum_(i=1)^n i^3=((n(n+1))/2)^2` Second formula: `x = (-b +- sqrt(b^2-4ac))/(2a)`" ;
    var promise = mf.format(question);
    var expect = 'First formula: <span class="mjx-chtml"><span class="mjx-math" aria-label="sum_(i=1)^n i^3=((n(n+1))/2)^2"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mrow" style="padding-left: 0.111em; padding-right: 0.167em;"><span class="mjx-munderover"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.247em; padding-top: 0.141em; padding-left: 0.917em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span><span class="mjx-op"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.74em; padding-bottom: 0.74em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.256em;"><span class="mjx-mrow" style=""><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">i</span></span><span class="mjx-mo" style="padding-left: 0.15em; padding-right: 0.15em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">i</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">3</span></span></span></span><span class="mjx-mo" style="padding-left: 0.333em; padding-right: 0.333em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 1.551em; padding-bottom: 1.551em;">(</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 3.989em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.989em; top: -1.59em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span></span></span><span class="mjx-denominator" style="width: 3.989em; bottom: -0.756em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 3.989em;" class="mjx-line"></span></span><span style="height: 2.346em; vertical-align: -0.756em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 1.551em; padding-bottom: 1.551em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 2.124em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span></span></span> Second formula: <span class="mjx-chtml"><span class="mjx-math" aria-label="x = (-b +- sqrt(b^2-4ac))/(2a)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo" style="padding-left: 0.333em; padding-right: 0.333em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 7.254em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 7.254em; top: -1.65em;"><span class="mjx-mrow"><span class="mjx-mo" style="padding-right: 0.111em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">±</span></span><span class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.519em; padding-bottom: 0.519em;">√</span></span><span class="mjx-box" style="padding-top: 0.045em; border-top: 1px solid;"><span class="mjx-mrow"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">c</span></span></span></span></span></span></span></span></span><span class="mjx-denominator" style="width: 7.254em; bottom: -0.766em;"><span class="mjx-mrow"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 7.254em;" class="mjx-line"></span></span><span style="height: 2.416em; vertical-align: -0.766em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.equal(formattedQuestion, expect);
        test.done();
    }, (failMsg) => {
      test.expect(1);
      test.ok(false, failMsg);
      test.done();

    });
};

exports['malformed question - missing final backtick'] = function (test) {
    var question = "What is the value? `((2^4)^9)/((4^8)^2)";
    var expect = 'What is the value? <span class="mjx-chtml"><span class="mjx-math" aria-label="((2^4)^9)/((4^8)^2)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.394em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.394em; top: -2.044em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.907em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">9</span></span></span></span></span></span><span class="mjx-denominator" style="width: 2.394em; bottom: -1.547em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.607em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">8</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.912em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 2.394em;" class="mjx-line"></span></span><span style="height: 3.592em; vertical-align: -1.547em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.ok(false, formattedQuestion);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(true, failMsg);
        test.done();
    });
};

exports['malformed question - missing initial backtick'] = function (test) {
    var question = "What is the value? ((2^4)^9)/((4^8)^2)`";
    var expect = 'What is the value? <span class="mjx-chtml"><span class="mjx-math" aria-label="((2^4)^9)/((4^8)^2)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.394em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.394em; top: -2.044em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.907em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">9</span></span></span></span></span></span><span class="mjx-denominator" style="width: 2.394em; bottom: -1.547em;"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">(</span></span><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.607em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">8</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.593em; padding-bottom: 0.593em;">)</span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.912em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 2.394em;" class="mjx-line"></span></span><span style="height: 3.592em; vertical-align: -1.547em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.ok(false, formattedQuestion);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(true, failMsg);
        test.done();
    });
};

exports['figure-10 substituion'] = function (test) {

    var question = "How many squares of any size are in this figure consisting of adjacent unit squares surrounding a larger square? `figure-10`";
    var expect = "How many squares of any size are in this figure consisting of adjacent unit squares surrounding a larger square? <div><img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABJAQMAAABLvZmfAAAABlBMVEX///8jHyCZ/QWRAAAALUlEQVQoz2P4DwMNDA0MCgwcDEwMDEOPieYLBpDo0GP+//8AyGQe8r4YXikKAHXFeVRwVlYzAAAAAElFTkSuQmCC></div>";
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.equal(formattedQuestion, expect);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(false, failMsg);
        test.done();
    });
};

exports['format a question and answer'] = function (test) {
    var question = "What does the quadratic equation look like with typesetting? Example: `figure-01`";
    var answer = "`x = (-b +- sqrt(b^2-4ac))/(2a)`";
    var promise1 = mf.format(question);
    var promise2 = mf.format(answer);
    var expect1 = "What does the quadratic equation look like with typesetting? Example: <div><img src=data:image/png;base64,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></div>";
    var expect2 = '<span class="mjx-chtml"><span class="mjx-math" aria-label="x = (-b +- sqrt(b^2-4ac))/(2a)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo" style="padding-left: 0.333em; padding-right: 0.333em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 7.254em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 7.254em; top: -1.65em;"><span class="mjx-mrow"><span class="mjx-mo" style="padding-right: 0.111em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">±</span></span><span class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.519em; padding-bottom: 0.519em;">√</span></span><span class="mjx-box" style="padding-top: 0.045em; border-top: 1px solid;"><span class="mjx-mrow"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">c</span></span></span></span></span></span></span></span></span><span class="mjx-denominator" style="width: 7.254em; bottom: -0.766em;"><span class="mjx-mrow"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 7.254em;" class="mjx-line"></span></span><span style="height: 2.416em; vertical-align: -0.766em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    var promises = [promise1, promise2];
    Promise.all(promises).then( (results) => {
        test.expect(2);
        test.equal(results[0], expect1);
        test.equal(results[1], expect2);
        test.done();
    }).catch ((failMsg) => {
        test.expect(1);
        test.ok(false, failMsg);
        test.done();
    });
};

exports['question with figure and formula'] = function (test) {
    var question = "Quadratic equation image: `figure-01` and formula: `x = (-b +- sqrt(b^2-4ac))/(2a)`";
    var expect = 'Quadratic equation image: <div><img src=data:image/png;base64,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></div> and formula: <span class="mjx-chtml"><span class="mjx-math" aria-label="x = (-b +- sqrt(b^2-4ac))/(2a)"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mstyle"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo" style="padding-left: 0.333em; padding-right: 0.333em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 7.254em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 7.254em; top: -1.65em;"><span class="mjx-mrow"><span class="mjx-mo" style="padding-right: 0.111em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">±</span></span><span class="mjx-msqrt"><span class="mjx-box" style="padding-top: 0.045em;"><span class="mjx-surd"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.519em; padding-bottom: 0.519em;">√</span></span><span class="mjx-box" style="padding-top: 0.045em; border-top: 1px solid;"><span class="mjx-mrow"><span class="mjx-mrow"><span class="mjx-msup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span><span class="mjx-mo" style="padding-left: 0.267em; padding-right: 0.267em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">c</span></span></span></span></span></span></span></span></span><span class="mjx-denominator" style="width: 7.254em; bottom: -0.766em;"><span class="mjx-mrow"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 7.254em;" class="mjx-line"></span></span><span style="height: 2.416em; vertical-align: -0.766em;" class="mjx-vsize"></span></span></span></span></span></span></span>';
    var promise = mf.format(question);
    promise.then( (formattedQuestion) => {
        test.expect(1);
        test.equal(formattedQuestion, expect);
        test.done();
    }, (failMsg) => {
        test.expect(1);
        test.ok(false, failMsg);
        test.done();
    });
};

//exports[''] = function (test) {
//     var promise = mf.format(question);
//     promise.then( (formattedQuestion) => {
//
//     }, (failMsg) => {
//         test.expect(1);
//         test.ok(false, failMsg);
//         test.done();
//     });
//};

